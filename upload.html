<input type="file" id="csvUpload" accept=".csv">
<div id="filters"></div>
<div class="products-grid cols-3" id="productGrid"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
let allProducts = [];

// Listen for CSV upload
document.getElementById("csvUpload").addEventListener("change", function(e) {
  const file = e.target.files[0];
  if (!file) return;

  Papa.parse(file, {
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
      allProducts = results.data;
      setupFilters();
      renderProducts(allProducts);
    }
  });
});

// --- FILTERS ---
function setupFilters() {
  const filtersDiv = document.getElementById("filters");
  filtersDiv.innerHTML = "";

  const filterFields = ["color", "price", "keyword", "feel", "category", "ribbon", "bundle"];
  
  filterFields.forEach(field => {
    const label = document.createElement("label");
    label.innerText = field.charAt(0).toUpperCase() + field.slice(1) + ": ";
    const input = document.createElement("input");
    input.setAttribute("data-field", field);
    input.addEventListener("input", applyFilters);
    label.appendChild(input);
    filtersDiv.appendChild(label);
    filtersDiv.appendChild(document.createTextNode(" "));
  });
}

// --- RENDER PRODUCTS ---
function renderProducts(products) {
  const grid = document.getElementById("productGrid");
  grid.innerHTML = "";

  products.forEach(p => {
    const card = document.createElement("div");
    card.className = "product-card";

    // Product label
    const label = document.createElement("div");
    label.className = "top-label";
    label.innerText = p.ribbon || ""; 
    card.appendChild(label);

    // Keyword bubbles
    const bubbles = document.createElement("div");
    bubbles.className = "top-bubbles";
    if (p.keyword) bubbles.innerHTML = `<div>${p.keyword}</div>`;
    if (p.feel) bubbles.innerHTML += `<div>${p.feel}</div>`;
    card.appendChild(bubbles);

    // Image
    const imagesDiv = document.createElement("div");
    imagesDiv.className = "product-images";
    if (p.productImageUrl) {
      const imgWrapper = document.createElement("div");
      imgWrapper.className = "img-wrapper";
      const img = document.createElement("img");
      img.src = p.productImageUrl;
      imgWrapper.appendChild(img);
      imagesDiv.appendChild(imgWrapper);
    }
    card.appendChild(imagesDiv);

    // Info
    const info = document.createElement("div");
    info.className = "product-info";
    info.innerHTML = `<div class="product-bottom"><h3>${p.name}</h3>
                      <div class="price-container"><div class="price-line">
                      <span class="price">$${p.price}</span>
                      </div></div></div>`;
    card.appendChild(info);

    grid.appendChild(card);
  });
}

// --- APPLY FILTERS ---
function applyFilters() {
  const inputs = document.querySelectorAll("#filters input");
  let filtered = allProducts;

  inputs.forEach(input => {
    const field = input.dataset.field;
    const value = input.value.trim().toLowerCase();
    if (value) {
      filtered = filtered.filter(p => (p[field] || "").toLowerCase().includes(value));
    }
  });

  renderProducts(filtered);
}
</script>

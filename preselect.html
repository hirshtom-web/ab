<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Product Admin Editor</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 4px; text-align: left; }
    img { max-width: 50px; }
    select, input, textarea { width: 100%; box-sizing: border-box; }
    textarea { resize: vertical; }
  </style>
</head>
<body>

<h2>Upload CSV</h2>
<input type="file" id="csvFile" accept=".csv">
<button onclick="exportJSON()">Export JSON</button>
<button onclick="exportCSV()">Export CSV</button>

<h2>Products Table</h2>
<table>
  <thead>
    <tr>
      <th>Image</th>
      <th>ID</th>
      <th>Name</th>
      <th>Type</th>
      <th>Price</th>
      <th>Category</th>
      <th>Collection</th>
      <th>Artist</th>
      <th>Artist Name</th>
      <th>Color</th>
      <th>Color Story</th>
      <th>Room</th>
      <th>Emotional Energy</th>
      <th>Scale</th>
      <th>Quantity</th>
      <th>Ribbon</th>
      <th>Keywords</th>
      <th>Bio</th>
      <th>Meaning</th>
      <th>Download</th>
      <th>Visible</th>
    </tr>
  </thead>
  <tbody id="rows"></tbody>
</table>

<script>
// ------------------ YOUR FULL JS HERE ------------------
const productTypes = ["single","pair","trio","bundle"];
const categories = ["Abstract","Architecture","Botanic","Figurative","Geometric","Line Art","Photo Art","Bauhaus"];
const collections = ["Best Sellers","New In","Trending","Limited Edition"];
const artistTypes = ["famous","featured","other"];
const colors = ["Black","White","Beige","Blue","Green","Red","Multi"];
const rooms = ["Living Room","Bedroom","Office","Hallway"];
const energies = ["Calm","Bold","Energetic","Minimal","Romantic"];
const scales = ["Small","Medium","Large","Statement"];
const ribbons = ["","New","Best Seller","Limited"];

let products = [];

// ------------------ LOAD CSV ------------------
document.getElementById("csvFile").addEventListener("change", e => {
  Papa.parse(e.target.files[0], {
    header:true,
    skipEmptyLines:true,
    complete: res => {
      products = res.data.map(p => ({
        productId: (p.productId || "").trim(),
        name: (p.name || "").trim(),
        price: Number(p.price) || 0,
        productType: p.productType || p.type || p.kind || "single",
        productImageUrl: split(p.productImageUrl),
        category: split(p.category),
        collection: split(p.collection),
        color: split(p.color),
        artist: p.artist || "other",
        artistName: p.artistName || "",
        room: split(p.room),
        emotionalEnergy: split(p.emotionalEnergy),
        scalePresence: p.scalePresence || "Medium",
        colorStory: p.colorStory || "",
        meaning: p.meaning || "",
        quantity: Number(p.quantity) || 1,
        keywords: split(p.keywords),
        ribbon: p.ribbon || "",
        bio: p.bio || "",
        downloadLinkUrl: p.downloadLinkUrl || "",
        visible: p.visible !== "false"
      }));
      render();
    }
  });
});

function split(v){ return v ? v.split(";").map(x=>x.trim()) : []; }

// ------------------ RENDER TABLE ------------------
function render(){
  const tbody = document.getElementById("rows");
  tbody.innerHTML = "";

  products.forEach((p,i)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
<td><img src="${img(p.productImageUrl)}" width="50"></td>
<td><input value="${p.productId||""}" onchange="u(${i},'productId',this.value)"></td>
<td><input value="${p.name||""}" onchange="u(${i},'name',this.value)"></td>
<td>${select(productTypes,p.productType,i,"productType")}</td>
<td><input type="number" value="${p.price||0}" onchange="u(${i},'price',+this.value)"></td>
<td>${multi(categories,p.category,i,"category")}</td>
<td>${multi(collections,p.collection,i,"collection")}</td>
<td>${select(artistTypes,p.artist,i,"artist")}</td>
<td><input value="${p.artistName||""}" onchange="u(${i},'artistName',this.value)"></td>
<td>${multi(colors,p.color,i,"color")}</td>
<td><input value="${p.colorStory||""}" onchange="u(${i},'colorStory',this.value)"></td>
<td>${multi(rooms,p.room,i,"room")}</td>
<td>${multi(energies,p.emotionalEnergy,i,"emotionalEnergy")}</td>
<td>${select(scales,p.scalePresence,i,"scalePresence")}</td>
<td><input type="number" value="${p.quantity||1}" onchange="u(${i},'quantity',+this.value)"></td>
<td>${select(ribbons,p.ribbon,i,"ribbon")}</td>
<td><input value="${(p.keywords||[]).join('; ')}" onchange="u(${i},'keywords',split(this.value))"></td>
<td><textarea onchange="u(${i},'bio',this.value)">${p.bio||""}</textarea></td>
<td><textarea onchange="u(${i},'meaning',this.value)">${p.meaning||""}</textarea></td>
<td><input value="${p.downloadLinkUrl||""}" onchange="u(${i},'downloadLinkUrl',this.value)"></td>
<td><input type="checkbox" ${p.visible?"checked":""} onchange="u(${i},'visible',this.checked)"></td>
    `;
    tbody.appendChild(tr);
  });
}

function img(arr){
  const v = arr && arr[0];
  if(!v) return "";
  return v.includes("http") ? v : 'https://static.wixstatic.com/media/' + v;
}

function select(opts,val,i,f){
  return `<select onchange="u(${i},'${f}',this.value)">
    ${opts.map(o=>`<option ${o===val?"selected":""}>${o}</option>`).join("")}
  </select>`;
}

function multi(opts,vals,i,f){
  return `<select multiple class="multi" onchange="u(${i},'${f}',[...this.selectedOptions].map(o=>o.value))">
    ${opts.map(o=>`<option ${vals?.includes(o)?"selected":""}>${o}</option>`).join("")}
  </select>`;
}

function u(i,f,v){ products[i][f]=v; }

// ------------------ EXPORT JSON ------------------
function exportJSON(){
  const clean = products.map(p=>({
    ...p,
    productImageUrl: p.productImageUrl,
    category: p.category,
    collection: p.collection,
    color: p.color,
    room: p.room,
    emotionalEnergy: p.emotionalEnergy,
    keywords: p.keywords
  }));
  const a=document.createElement("a");
  a.href="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(clean,null,2));
  a.download="products.json";
  a.click();
}

// ------------------ EXPORT CSV ------------------
function exportCSV(){
  const data = products.map(p=>{
    return {
      productId:p.productId,
      name:p.name,
      price:p.price,
      productType:p.productType,
      productImageUrl:p.productImageUrl.join(";"),
      category:p.category.join(";"),
      collection:p.collection.join(";"),
      color:p.color.join(";"),
      artist:p.artist,
      artistName:p.artistName,
      room:p.room.join(";"),
      emotionalEnergy:p.emotionalEnergy.join(";"),
      scalePresence:p.scalePresence,
      colorStory:p.colorStory,
      meaning:p.meaning,
      quantity:p.quantity,
      keywords:p.keywords.join(";"),
      ribbon:p.ribbon,
      bio:p.bio,
      downloadLinkUrl:p.downloadLinkUrl,
      visible:p.visible
    }
  });
  const csv = Papa.unparse(data);
  const a = document.createElement("a");
  a.href = "data:text/csv;charset=utf-8," + encodeURIComponent(csv);
  a.download = "products_updated.csv";
  a.click();
}
</script>

</body>
</html>

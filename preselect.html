<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Product Admin Editor</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<style>
body {
  font-family: Inter, Arial, sans-serif;
  background:#f6f6f6;
  padding:20px;
}
h1 { margin-bottom:10px; }

.controls {
  display:flex;
  gap:10px;
  margin-bottom:15px;
}

button {
  padding:8px 14px;
  cursor:pointer;
}

table {
  width:100%;
  border-collapse:collapse;
  background:#fff;
}

th, td {
  border:1px solid #ddd;
  padding:6px;
  vertical-align:top;
  font-size:12px;
}

th {
  background:#eee;
  position:sticky;
  top:0;
  z-index:2;
}

img {
  width:80px;
  height:80px;
  object-fit:cover;
}

input, textarea, select {
  width:100%;
  font-size:12px;
}

textarea { resize:vertical; }

.multi {
  height:60px;
}

.toggle {
  transform:scale(1.2);
}
</style>
</head>
<body>

<h1>Product Admin Editor</h1>

<div class="controls">
  <input type="file" id="csvFile" accept=".csv" />
  <button onclick="exportJSON()">Export JSON</button>
</div>

<table>
<thead>
<tr>
  <th>Image</th>
  <th>ID</th>
  <th>Name</th>
  <th>Type</th>
  <th>Price</th>
  <th>Category</th>
  <th>Collection</th>
  <th>Artist</th>
  <th>Artist Name</th>
  <th>Color</th>
  <th>Color Story</th>
  <th>Room</th>
  <th>Emotional Energy</th>
  <th>Scale</th>
  <th>Quantity</th>
  <th>Ribbon</th>
  <th>Keywords</th>
  <th>Bio</th>
  <th>Meaning</th>
  <th>Download</th>
  <th>Visible</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<script>
const productTypes = ["single","pair","trio","bundle"];
const categories = ["Abstract","Architecture","Botanic","Figurative","Geometric","Line Art","Photo Art","Bauhaus"];
const collections = ["Best Sellers","New In","Trending","Limited Edition"];
const artistTypes = ["famous","featured","other"];
const colors = ["Black","White","Beige","Blue","Green","Red","Multi"];
const rooms = ["Living Room","Bedroom","Office","Hallway"];
const energies = ["Calm","Bold","Energetic","Minimal","Romantic"];
const scales = ["Small","Medium","Large","Statement"];
const ribbons = ["","New","Best Seller","Limited"];

let products = [];

document.getElementById("csvFile").addEventListener("change", e => {
  Papa.parse(e.target.files[0], {
    header:true,
    skipEmptyLines:true,
    complete: res => {
      products = res.data.map(p => ({
        ...p,
        productImageUrl: split(p.productImageUrl),
        category: split(p.category),
        collection: split(p.collection),
        color: split(p.color),
        room: split(p.room),
        emotionalEnergy: split(p.emotionalEnergy),
        keywords: split(p.keywords),
        visible: p.visible !== "false"
      }));
      render();
    }
  });
});

function split(v){ return v ? v.split(";").map(x=>x.trim()) : []; }

function render(){
  const tbody = document.getElementById("rows");
  tbody.innerHTML = "";

  products.forEach((p,i)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
<td><img src="${img(p.productImageUrl)}"></td>
<td><input value="${p.productId||""}" onchange="u(${i},'productId',this.value)"></td>
<td><input value="${p.name||""}" onchange="u(${i},'name',this.value)"></td>

<td>${select(productTypes,p.productType,i,"productType")}</td>
<td><input type="number" value="${p.price||0}" onchange="u(${i},'price',+this.value)"></td>

<td>${multi(categories,p.category,i,"category")}</td>
<td>${multi(collections,p.collection,i,"collection")}</td>

<td>${select(artistTypes,p.artist,i,"artist")}</td>
<td><input value="${p.artistName||""}" onchange="u(${i},'artistName',this.value)"></td>

<td>${multi(colors,p.color,i,"color")}</td>
<td><input value="${p.colorStory||""}" onchange="u(${i},'colorStory',this.value)"></td>

<td>${multi(rooms,p.room,i,"room")}</td>
<td>${multi(energies,p.emotionalEnergy,i,"emotionalEnergy")}</td>
<td>${select(scales,p.scalePresence,i,"scalePresence")}</td>

<td><input type="number" value="${p.quantity||1}" onchange="u(${i},'quantity',+this.value)"></td>
<td>${select(ribbons,p.ribbon,i,"ribbon")}</td>

<td><input value="${(p.keywords||[]).join('; ')}" onchange="u(${i},'keywords',split(this.value))"></td>

<td><textarea onchange="u(${i},'bio',this.value)">${p.bio||""}</textarea></td>
<td><textarea onchange="u(${i},'meaning',this.value)">${p.meaning||""}</textarea></td>

<td><input value="${p.downloadLinkUrl||""}" onchange="u(${i},'downloadLinkUrl',this.value)"></td>
<td><input type="checkbox" class="toggle" ${p.visible?"checked":""} onchange="u(${i},'visible',this.checked)"></td>
`;
    tbody.appendChild(tr);
  });
}

function img(arr){
  const v = arr && arr[0];
  if(!v) return "";
  return v.includes("http") ? v : "https://static.wixstatic.com/media/" + v;
}

function select(opts,val,i,f){
  return `<select onchange="u(${i},'${f}',this.value)">
    ${opts.map(o=>`<option ${o===val?"selected":""}>${o}</option>`).join("")}
  </select>`;
}

function multi(opts,vals,i,f){
  return `<select multiple class="multi" onchange="u(${i},'${f}',[...this.selectedOptions].map(o=>o.value))">
    ${opts.map(o=>`<option ${vals?.includes(o)?"selected":""}>${o}</option>`).join("")}
  </select>`;
}

function u(i,f,v){ products[i][f]=v; }

function exportJSON(){
  const clean = products.map(p=>({
    ...p,
    productImageUrl: p.productImageUrl,
    category:p.category,
    collection:p.collection,
    color:p.color,
    room:p.room,
    emotionalEnergy:p.emotionalEnergy,
    keywords:p.keywords
  }));
  const a=document.createElement("a");
  a.href="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(clean,null,2));
  a.download="products.json";
  a.click();
}
</script>
</body>
</html>

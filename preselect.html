<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Product Admin Cards</title>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<style>
  body { font-family: sans-serif; margin: 20px; }
  .card-grid { display: flex; flex-direction: column; gap: 20px; }
  .product-card {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr; /* 4 columns */
    gap: 10px;
    border: 1px solid #ccc;
    padding: 10px;
    border-radius: 8px;
  }
  .product-card img { width: 100%; max-width: 150px; border-radius: 4px; }
  .column { display: flex; flex-direction: column; gap: 6px; }
  .column input, .column select, .column textarea { width: 100%; box-sizing: border-box; }
  .column textarea { resize: vertical; }
  .column h4 { margin: 0 0 4px 0; font-size: 0.9rem; color: #555; }
</style>
</head>
<body>

<h2>Upload CSV</h2>
<input type="file" id="csvFile" accept=".csv">
<button onclick="exportJSON()">Export JSON</button>
<button onclick="exportCSV()">Export CSV</button>

<div class="card-grid" id="productGrid"></div>

<script>
const productTypes = ["single","pair","trio","bundle"];
const categories = ["Abstract","Architecture","Botanic","Figurative","Geometric","Line Art","Photo Art","Bauhaus"];
const collections = ["Best Sellers","New In","Trending","Limited Edition"];
const artistTypes = ["famous","featured","other"];
const colors = ["Black","White","Beige","Blue","Green","Red","Multi"];
const rooms = ["Living Room","Bedroom","Office","Hallway"];
const energies = ["Calm","Bold","Energetic","Minimal","Romantic"];
const scales = ["Small","Medium","Large","Statement"];
const ribbons = ["","New","Best Seller","Limited"];

let products = [];

// ------------------ LOAD CSV ------------------
document.getElementById("csvFile").addEventListener("change", e => {
  Papa.parse(e.target.files[0], {
    header:true,
    skipEmptyLines:true,
    complete: res => {
      products = res.data.map(p => ({
        productId: (p.productId || "").trim(),
        name: (p.name || "").trim(),
        price: Number(p.price) || 0,
        productType: p.productType || p.type || p.kind || "single",
        productImageUrl: split(p.productImageUrl),
        category: split(p.category),
        collection: split(p.collection),
        color: split(p.color),
        artist: p.artist || "other",
        artistName: p.artistName || "",
        room: split(p.room),
        emotionalEnergy: split(p.emotionalEnergy),
        scalePresence: p.scalePresence || "Medium",
        colorStory: p.colorStory || "",
        meaning: p.meaning || "",
        quantity: Number(p.quantity) || 1,
        keywords: split(p.keywords),
        ribbon: p.ribbon || "",
        bio: p.bio || "",
        downloadLinkUrl: p.downloadLinkUrl || "",
        visible: p.visible !== "false"
      }));
      renderCards();
    }
  });
});

function split(v){ return v ? v.split(";").map(x=>x.trim()) : []; }

function renderCards(){
  const grid = document.getElementById("productGrid");
  grid.innerHTML = "";

  products.forEach((p,i)=>{
    const card = document.createElement("div");
    card.className = "product-card";

    // Column 1 - Image / Gallery
    const col1 = document.createElement("div");
    col1.className = "column";
    const imgSrc = p.productImageUrl[0] ? (p.productImageUrl[0].includes("http") ? p.productImageUrl[0] : 'https://static.wixstatic.com/media/' + p.productImageUrl[0]) : "";
    col1.innerHTML = `<h4>Image</h4><img src="${imgSrc}" alt="${p.name}">`;

    // Column 2 - Basic info
    const col2 = document.createElement("div");
    col2.className = "column";
    col2.innerHTML = `
<h4>ID</h4><input value="${p.productId||""}" onchange="u(${i},'productId',this.value)">
<h4>Name</h4><input value="${p.name||""}" onchange="u(${i},'name',this.value)">
<h4>Type</h4>${select(productTypes,p.productType,i,"productType")}
<h4>Price</h4><input type="number" value="${p.price||0}" onchange="u(${i},'price',+this.value)">
<h4>Quantity</h4><input type="number" value="${p.quantity||1}" onchange="u(${i},'quantity',+this.value)">
<h4>Visible</h4><input type="checkbox" ${p.visible?"checked":""} onchange="u(${i},'visible',this.checked)">
    `;

    // Column 3 - Attributes
    const col3 = document.createElement("div");
    col3.className = "column";
    col3.innerHTML = `
<h4>Category</h4>${multi(categories,p.category,i,"category")}
<h4>Collection</h4>${multi(collections,p.collection,i,"collection")}
<h4>Color</h4>${multi(colors,p.color,i,"color")}
<h4>Room</h4>${multi(rooms,p.room,i,"room")}
<h4>Energy</h4>${multi(energies,p.emotionalEnergy,i,"emotionalEnergy")}
<h4>Scale</h4>${select(scales,p.scalePresence,i,"scalePresence")}
<h4>Ribbon</h4>${select(ribbons,p.ribbon,i,"ribbon")}
    `;

    // Column 4 - Text fields
    const col4 = document.createElement("div");
    col4.className = "column";
    col4.innerHTML = `
<h4>Artist</h4>${select(artistTypes,p.artist,i,"artist")}
<h4>Artist Name</h4><input value="${p.artistName||""}" onchange="u(${i},'artistName',this.value)">
<h4>Color Story</h4><input value="${p.colorStory||""}" onchange="u(${i},'colorStory',this.value)">
<h4>Keywords</h4><input value="${(p.keywords||[]).join('; ')}" onchange="u(${i},'keywords',split(this.value))">
<h4>Bio</h4><textarea onchange="u(${i},'bio',this.value)">${p.bio||""}</textarea>
<h4>Meaning</h4><textarea onchange="u(${i},'meaning',this.value)">${p.meaning||""}</textarea>
<h4>Download</h4><input value="${p.downloadLinkUrl||""}" onchange="u(${i},'downloadLinkUrl',this.value)">
    `;

    card.appendChild(col1);
    card.appendChild(col2);
    card.appendChild(col3);
    card.appendChild(col4);

    grid.appendChild(card);
  });
}

function select(opts,val,i,f){
  return `<select onchange="u(${i},'${f}',this.value)">
    ${opts.map(o=>`<option ${o===val?"selected":""}>${o}</option>`).join("")}
  </select>`;
}

function multi(opts,vals,i,f){
  return `<select multiple class="multi" onchange="u(${i},'${f}',[...this.selectedOptions].map(o=>o.value))">
    ${opts.map(o=>`<option ${vals?.includes(o)?"selected":""}>${o}</option>`).join("")}
  </select>`;
}

function u(i,f,v){ products[i][f]=v; }

// ------------------ EXPORT ------------------
function exportJSON(){
  const a=document.createElement("a");
  a.href="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(products,null,2));
  a.download="products.json";
  a.click();
}

function exportCSV(){
  const data = products.map(p=>{
    return {
      productId:p.productId,
      name:p.name,
      price:p.price,
      productType:p.productType,
      productImageUrl:p.productImageUrl.join(";"),
      category:p.category.join(";"),
      collection:p.collection.join(";"),
      color:p.color.join(";"),
      artist:p.artist,
      artistName:p.artistName,
      room:p.room.join(";"),
      emotionalEnergy:p.emotionalEnergy.join(";"),
      scalePresence:p.scalePresence,
      colorStory:p.colorStory,
      meaning:p.meaning,
      quantity:p.quantity,
      keywords:p.keywords.join(";"),
      ribbon:p.ribbon,
      bio:p.bio,
      downloadLinkUrl:p.downloadLinkUrl,
      visible:p.visible
    }
  });
  const csv = Papa.unparse(data);
  const a = document.createElement("a");
  a.href = "data:text/csv;charset=utf-8," + encodeURIComponent(csv);
  a.download = "products_updated.csv";
  a.click();
}
</script>

</body>
</html>

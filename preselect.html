<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Preselect Products</title>
<style>
  body { font-family: sans-serif; margin: 20px; }
  h1 { text-align: center; }
  #productGrid { display: grid; grid-template-columns: repeat(auto-fill,minmax(150px,1fr)); gap: 15px; margin-top: 20px; }
  .product-card { border: 1px solid #ccc; border-radius: 8px; padding: 10px; cursor: pointer; display: flex; flex-direction: column; align-items: center; text-align: center; }
  .product-card.selected { border-color: #007bff; background: #e6f0ff; }
  .product-card img { width: 100%; border-radius: 8px; margin-bottom: 8px; }
  .price-old { text-decoration: line-through; color: #999; margin-right: 5px; }
  button { margin: 10px; padding: 8px 16px; cursor: pointer; }
</style>
</head>
<body>

<h1>Preselect Products</h1>
<div style="text-align:center;">
  <button id="saveSelection">Save Selection</button>
</div>

<div id="productGrid"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
<script>
// Example products (replace with CSV/JSON fetch)
let allProducts = [
  {id: "1", name: "Product 1", price: 20, oldPrice: 25, image: "https://via.placeholder.com/150"},
  {id: "2", name: "Product 2", price: 15, oldPrice: 0, image: "https://via.placeholder.com/150"},
  {id: "3", name: "Product 3", price: 40, oldPrice: 50, image: "https://via.placeholder.com/150"},
  {id: "4", name: "Product 4", price: 30, oldPrice: 0, image: "https://via.placeholder.com/150"},
  {id: "5", name: "Product 5", price: 10, oldPrice: 12, image: "https://via.placeholder.com/150"}
];

// Load previous selection from localStorage
let selectedProducts = JSON.parse(localStorage.getItem('selectedProducts')) || [];

const productGrid = document.getElementById('productGrid');

// Render all products
function renderProducts() {
  productGrid.innerHTML = "";
  allProducts.forEach(p => {
    const card = document.createElement('div');
    card.className = 'product-card';
    card.dataset.id = p.id;
    if (selectedProducts.includes(p.id)) card.classList.add('selected');

    card.innerHTML = `
      <img src="${p.image}" alt="${p.name}">
      <strong>${p.name}</strong>
      <div class="price-wrapper">
        ${p.oldPrice ? `<span class="price-old">$${p.oldPrice}</span>` : ''}
        <span class="price-new">$${p.price}</span>
      </div>
    `;

    card.addEventListener('click', () => {
      if (selectedProducts.includes(p.id)) {
        selectedProducts = selectedProducts.filter(id => id !== p.id);
        card.classList.remove('selected');
      } else {
        selectedProducts.push(p.id);
        card.classList.add('selected');
      }
    });

    productGrid.appendChild(card);
  });
}

// Enable drag-and-drop **only for selected products**
new Sortable(productGrid, {
  animation: 150,
  filter: '.product-card:not(.selected)', // only selected are draggable
  onEnd: () => {
    // Update selectedProducts order based on visible order
    const newOrder = [];
    productGrid.querySelectorAll('.product-card.selected').forEach(card => {
      newOrder.push(card.dataset.id);
    });
    selectedProducts = newOrder;
  }
});

renderProducts();

// Save selection
document.getElementById('saveSelection').addEventListener('click', () => {
  localStorage.setItem('selectedProducts', JSON.stringify(selectedProducts));
  alert('Selection saved! You can now render this order on the public page.');
});
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Product Admin Editor</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<style>
body {
  font-family: Inter, Arial, sans-serif;
  background:#f6f6f6;
  padding:20px;
}
h1 { margin-bottom:10px; }

.controls {
  display:flex;
  gap:10px;
  margin-bottom:15px;
}

button {
  padding:8px 14px;
  cursor:pointer;
}

table {
  width:100%;
  border-collapse:collapse;
  background:#fff;
}

th, td {
  border:1px solid #ddd;
  padding:6px;
  vertical-align:top;
  font-size:12px;
}

th {
  background:#eee;
  position:sticky;
  top:0;
  z-index:2;
}

img {
  width:80px;
  height:80px;
  object-fit:cover;
}

input, textarea, select {
  width:100%;
  font-size:12px;
}

textarea { resize:vertical; }

.multi {
  height:60px;
}

.toggle {
  transform:scale(1.2);
}
</style>
</head>
<body>

<h1>Product Admin Editor</h1>

<div class="controls">
  <input type="file" id="csvFile" accept=".csv" />
  <button onclick="exportJSON()">Export JSON</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
/* ============================
   CONFIG
============================ */
const productTypes = ["single","pair","trio","bundle"];
const categories = ["Abstract","Architecture","Botanic","Figurative","Geometric","Line Art","Photo Art","Bauhaus"];
const collections = ["Best Sellers","New In","Trending","Limited Edition"];
const artistTypes = ["famous","featured","other"];
const colors = ["Black","White","Beige","Blue","Green","Red","Multi"];
const rooms = ["Living Room","Bedroom","Office","Hallway"];
const energies = ["Calm","Bold","Energetic","Minimal","Romantic"];
const scales = ["Small","Medium","Large","Statement"];
const ribbons = ["","New","Best Seller","Limited"];

let products = [];

/* ============================
   LOAD CSV (UPLOAD)
============================ */
const fileInput = document.getElementById("csvFile");
if (fileInput) {
  fileInput.addEventListener("change", e => {
    Papa.parse(e.target.files[0], {
      header: true,
      skipEmptyLines: true,
      complete: res => loadProducts(res.data),
      error: err => console.error("CSV load error", err)
    });
  });
}

/* ============================
   NORMALIZE CSV DATA
============================ */
function loadProducts(data) {
  products = data.map(p => ({
    productId: p.productId || "",
    name: p.name || "",
    price: Number(p.price) || 0,

    // ðŸ”§ SAFE TYPE MAPPING
    productType: p.productType || p.type || p.kind || "single",

    productImageUrl: split(p.productImageUrl),
    category: split(p.category),
    collection: split(p.collection),
    color: split(p.color),

    artist: p.artist || "other",
    artistName: p.artistName || "",

    room: split(p.room),
    emotionalEnergy: split(p.emotionalEnergy),
    scalePresence: p.scalePresence || "Medium",

    colorStory: p.colorStory || "",
    meaning: p.meaning || "",

    quantity: Number(p.quantity) || 1,
    keywords: split(p.keywords),

    ribbon: p.ribbon || "",
    bio: p.bio || "",
    downloadLinkUrl: p.downloadLinkUrl || "",

    visible: p.visible !== "false"
  }));

  render();
}

/* ============================
   HELPERS
============================ */
function split(v) {
  return v ? v.split(";").map(x => x.trim()).filter(Boolean) : [];
}

function img(arr) {
  const v = arr && arr[0];
  if (!v) return "";
  return v.includes("http")
    ? v
    : "https://static.wixstatic.com/media/" + v;
}

function update(i, field, value) {
  products[i][field] = value;
}

/* ============================
   RENDER TABLE
============================ */
function render() {
  const tbody = document.getElementById("rows");
  if (!tbody) return;

  tbody.innerHTML = "";

  products.forEach((p, i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
<td><img src="${img(p.productImageUrl)}"></td>
<td><input value="${p.productId}" onchange="update(${i},'productId',this.value)"></td>
<td><input value="${p.name}" onchange="update(${i},'name',this.value)"></td>

<td>${select(productTypes, p.productType, i, "productType")}</td>
<td><input type="number" value="${p.price}" onchange="update(${i},'price',+this.value)"></td>

<td>${multi(categories, p.category, i, "category")}</td>
<td>${multi(collections, p.collection, i, "collection")}</td>

<td>${select(artistTypes, p.artist, i, "artist")}</td>
<td><input value="${p.artistName}" onchange="update(${i},'artistName',this.value)"></td>

<td>${multi(colors, p.color, i, "color")}</td>
<td><input value="${p.colorStory}" onchange="update(${i},'colorStory',this.value)"></td>

<td>${multi(rooms, p.room, i, "room")}</td>
<td>${multi(energies, p.emotionalEnergy, i, "emotionalEnergy")}</td>
<td>${select(scales, p.scalePresence, i, "scalePresence")}</td>

<td><input type="number" value="${p.quantity}" onchange="update(${i},'quantity',+this.value)"></td>
<td>${select(ribbons, p.ribbon, i, "ribbon")}</td>

<td><input value="${p.keywords.join('; ')}" onchange="update(${i},'keywords',split(this.value))"></td>

<td><textarea onchange="update(${i},'bio',this.value)">${p.bio}</textarea></td>
<td><textarea onchange="update(${i},'meaning',this.value)">${p.meaning}</textarea></td>

<td><input value="${p.downloadLinkUrl}" onchange="update(${i},'downloadLinkUrl',this.value)"></td>
<td><input type="checkbox" ${p.visible ? "checked" : ""} onchange="update(${i},'visible',this.checked)"></td>
`;
    tbody.appendChild(tr);
  });
}

/* ============================
   SELECT HELPERS
============================ */
function select(opts, val, i, field) {
  const safe = opts.includes(val) ? val : opts[0];
  return `
<select onchange="update(${i},'${field}',this.value)">
  ${opts.map(o => `<option ${o === safe ? "selected" : ""}>${o}</option>`).join("")}
</select>`;
}

function multi(opts, vals, i, field) {
  vals = Array.isArray(vals) ? vals : [];
  return `
<select multiple class="multi" onchange="update(${i},'${field}',[...this.selectedOptions].map(o=>o.value))">
  ${opts.map(o => `<option ${vals.includes(o) ? "selected" : ""}>${o}</option>`).join("")}
</select>`;
}

/* ============================
   EXPORT JSON
============================ */
function exportJSON() {
  const data = JSON.stringify(products, null, 2);
  const a = document.createElement("a");
  a.href = "data:text/json;charset=utf-8," + encodeURIComponent(data);
  a.download = "products.json";
  a.click();
}
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Product Pre-Selector</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; vertical-align: top; }
  th { background: #eee; }
  img { max-width: 80px; max-height: 80px; object-fit: cover; }
  input, textarea, select { width: 100%; }
  textarea { resize: vertical; }
  .multi-select { height: 60px; }
  button { margin-top: 10px; padding: 8px 12px; }
</style>
</head>
<body>

<h1>Product Pre-Selector Dashboard</h1>

<input type="file" id="csvFile" accept=".csv">
<button id="exportBtn">Export JSON</button>

<table id="productTable">
  <thead>
    <tr>
      <th>Image</th>
      <th>Name</th>
      <th>Bio</th>
      <th>Artist</th>
      <th>Price</th>
      <th>Old Price</th>
      <th>Category</th>
      <th>Collection</th>
      <th>Color</th>
      <th>Keywords</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
const categories = ["Abstract","Architecture","Botanic","Drawings","Figurative","Geometric Shapes","Line Art","Photo Art","Other Categories","Bauhaus"];
const collections = ["Best Sellers","New In","Trending","Limited Edition","Other Collections"];
const colors = ["Black","Rose","White","Beige","Burgundy","Light Blue","Plum","Black/White","Blue","Brown","Green","Grey","Orange","Pink","Purple","Red","Yellow","Multi","Other Colors"];
const artists = ["Famous Artists","Featured Artists","Other Artists"];

let allProducts = [];

document.getElementById("csvFile").addEventListener("change", (e) => {
  const file = e.target.files[0];
  if (!file) return;

  Papa.parse(file, {
    header: true,
    skipEmptyLines: true,
    complete: (res) => {
      allProducts = res.data.map(p => ({
        productId: p.productId || "",
        name: p.name || "",
        bio: p.bio || "",
        artist: p.artist || "",
        price: p.price ? parseFloat(p.price) : 0,
        oldPrice: p.oldPrice ? parseFloat(p.oldPrice) : 0,
        category: p.category ? p.category.split(";").map(x=>x.trim()) : [],
        collection: p.collection ? p.collection.split(";").map(x=>x.trim()) : [],
        color: p.color ? p.color.split(";").map(x=>x.trim()) : [],
        keywords: p.keywords ? p.keywords.split(";").map(x=>x.trim()) : [],
        image: p.productImageUrl || ""
      }));
      renderTable();
    },
    error: (err) => console.error("CSV load failed:", err)
  });
});

function renderTable() {
  const tbody = document.querySelector("#productTable tbody");
  tbody.innerHTML = "";

  allProducts.forEach((p, index) => {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td><img src="${p.image}" alt="${p.name}"></td>
      <td><input type="text" value="${p.name}" data-field="name" data-index="${index}"></td>
      <td><textarea data-field="bio" data-index="${index}">${p.bio}</textarea></td>
      <td><select data-field="artist" data-index="${index}">
        ${artists.map(a => `<option ${a===p.artist?'selected':''}>${a}</option>`).join("")}
      </select></td>
      <td><input type="number" value="${p.price}" data-field="price" data-index="${index}"></td>
      <td><input type="number" value="${p.oldPrice}" data-field="oldPrice" data-index="${index}"></td>
      <td><select multiple class="multi-select" data-field="category" data-index="${index}">
        ${categories.map(c => `<option ${p.category.includes(c)?'selected':''}>${c}</option>`).join("")}
      </select></td>
      <td><select multiple class="multi-select" data-field="collection" data-index="${index}">
        ${collections.map(c => `<option ${p.collection.includes(c)?'selected':''}>${c}</option>`).join("")}
      </select></td>
      <td><select multiple class="multi-select" data-field="color" data-index="${index}">
        ${colors.map(c => `<option ${p.color.includes(c)?'selected':''}>${c}</option>`).join("")}
      </select></td>
      <td><input type="text" value="${p.keywords.join("; ")}" data-field="keywords" data-index="${index}"></td>
    `;

    tbody.appendChild(tr);
  });

  // Add change listeners to inputs
  tbody.querySelectorAll("input, textarea, select").forEach(el => {
    el.addEventListener("change", (e) => {
      const index = parseInt(el.dataset.index);
      const field = el.dataset.field;

      if (el.multiple) {
        const selected = Array.from(el.selectedOptions).map(o => o.value);
        allProducts[index][field] = selected;
      } else if (field === "keywords") {
        allProducts[index][field] = el.value.split(";").map(x=>x.trim());
      } else if (field === "price" || field === "oldPrice") {
        allProducts[index][field] = parseFloat(el.value);
      } else {
        allProducts[index][field] = el.value;
      }
    });
  });
}

document.getElementById("exportBtn").addEventListener("click", () => {
  const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(allProducts, null, 2));
  const dlAnchor = document.createElement("a");
  dlAnchor.setAttribute("href", dataStr);
  dlAnchor.setAttribute("download", "products.json");
  dlAnchor.click();
});
</script>
</body>
</html>

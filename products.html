<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ArteBarte Products</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; }
body { font-family: 'Poppins', sans-serif; margin:0; background:#fff; color:#111; }
header { text-align:center; padding:30px 20px 10px; }
header h1 { font-weight:600; font-size:20px; }

.grid-selector { display:flex; justify-content:center; gap:10px; margin:10px auto 30px; }
.grid-btn { padding:6px 14px; border-radius:8px; border:1px solid #ccc; background:#fff; font-size:12px; cursor:pointer; transition:0.2s ease; }
.grid-btn.active { background:#111; color:#fff; border-color:#111; }

.products-grid {
  display:grid;
  gap:20px;
  max-width:100%;
  margin:0 auto;
  padding:0 10px;
}

.products-grid.cols-3 { grid-template-columns: repeat(3, minmax(0,1fr)); }
.products-grid.cols-4 { grid-template-columns: repeat(4, minmax(0,1fr)); }

@media(max-width:600px){ .products-grid{ grid-template-columns: repeat(2,1fr) !important;} }

.product-card { position:relative; z-index:3; }
.product-images { display:flex; gap:10px; overflow-x:auto; scroll-snap-type:x mandatory; }
.product-images::-webkit-scrollbar { display:none; }
.img-wrapper { flex:0 0 auto; width:100%; aspect-ratio:1/1; border-radius:16px; overflow:hidden; scroll-snap-align:start; position:relative; }
.img-wrapper img { width:100%; height:100%; object-fit:cover; display:block; border-radius:16px; }

.plus-overlay { position:absolute; bottom:20px; right:12px; width:32px; height:32px; border-radius:50%; background:#111; color:#fff; font-size:18px; display:flex; align-items:center; justify-content:center; opacity:0; transition:0.2s ease; }
.product-card:hover .plus-overlay { opacity:1; }

.product-info { padding:8px 0; text-align:right; }
.product-info h3 { margin:0; font-size:14px; font-weight:500; }
.price { font-size:13px; font-weight:600; color:#333; }

.top-label { position:absolute; top:12px; left:12px; background:#ff5e5e; color:white; font-size:10px; padding:4px 8px; border-radius:12px; z-index:2; }
.top-bubbles { position:absolute; top:12px; right:12px; display:flex; gap:6px; z-index:2; }
.top-bubbles div { padding:3px 8px; font-size:9px; font-weight:500; color:#333; background: rgba(255,255,255,0.85); border-radius:10px; border:1px solid #eee; backdrop-filter:blur(6px); }

.banner-card { background:#f7f7f7; border-radius:16px; display:flex; justify-content:center; align-items:center; font-weight:600; color:#333; text-align:center; padding:10px; }
</style>
</head>
<body>

<header><h1>Gallery Walls</h1></header>

<div class="grid-selector">
  <button class="grid-btn active" data-cols="3">3 in row</button>
  <button class="grid-btn" data-cols="4">4 in row</button>
</div>

<div class="products-grid cols-3" id="productGrid"></div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
const grid = document.getElementById("productGrid");
const gridButtons = document.querySelectorAll(".grid-btn");
let allProducts = [];

Papa.parse("https://hirshtom-web.github.io/ab/new_product_list.csv", {
  download:true, header:true, skipEmptyLines:true,
  complete: results => { allProducts = results.data; renderProducts(); }
});

function renderProducts(){
  grid.innerHTML="";
  allProducts.forEach(p=>{
    const images=(p.productImageUrl||"").split(";").map(u=>u.trim()).filter(Boolean);
    if(!images.length) return; // hide product if no image

    const card=document.createElement("div"); card.className="product-card";

    const imgContainer=document.createElement("div"); imgContainer.className="product-images";
    images.forEach(url=>{
      const wrapper=document.createElement("div"); wrapper.className="img-wrapper";
      const img=document.createElement("img");
      img.src=url.includes("http")?url:"https://static.wixstatic.com/media/"+url;
      wrapper.appendChild(img);
      imgContainer.appendChild(wrapper);
    });
    card.appendChild(imgContainer);

    const plus=document.createElement("div"); plus.className="plus-overlay"; plus.innerText="+"; card.appendChild(plus);

    const info=document.createElement("div"); info.className="product-info";
    const h3=document.createElement("h3"); h3.innerText=p.name||p.Name||"Unnamed product"; info.appendChild(h3);
    const priceSpan=document.createElement("span"); priceSpan.className="price";
    priceSpan.innerText=p.price && p.price.trim()!=="" ? "$"+p.price : "$1";
    info.appendChild(priceSpan);
    card.appendChild(info);

    if(p.ribbon){ const label=document.createElement("div"); label.className="top-label"; label.innerText=p.ribbon; card.appendChild(label);}
    const bubbles=["category","color"].map(k=>p[k]).filter(Boolean);
    if(bubbles.length){ const bubbleDiv=document.createElement("div"); bubbleDiv.className="top-bubbles"; bubbles.forEach(b=>{const d=document.createElement("div"); d.innerText=b; bubbleDiv.appendChild(d);}); card.appendChild(bubbleDiv);}

    grid.appendChild(card);
  });

  // Insert banners after images load
  const imagesLoaded = Array.from(document.querySelectorAll(".img-wrapper img"));
  let loadedCount=0;
  imagesLoaded.forEach(img=>{
    img.onload = img.onerror = ()=>{
      loadedCount++;
      if(loadedCount===imagesLoaded.length) insertBanners();
    };
  });
}

// Banner insertion
function insertBanners(){
  grid.querySelectorAll(".banner-card").forEach(b=>b.remove());
  const cards=[...grid.querySelectorAll(".product-card")];
  for(let i=8;i<cards.length;i+=9){
    const banner=document.createElement("div"); banner.className="banner-card"; banner.innerText="âœ¨ New Collection Drop!";
    const firstImg=cards[i].querySelector(".img-wrapper img");
    if(firstImg) banner.style.height=firstImg.clientHeight+"px";
    grid.insertBefore(banner,cards[i]);
  }
}

gridButtons.forEach(btn=>{
  btn.addEventListener("click",()=>{
    gridButtons.forEach(b=>b.classList.remove("active")); btn.classList.add("active");
    grid.classList.remove("cols-3","cols-4"); grid.classList.add(`cols-${btn.dataset.cols}`);
    insertBanners();
  });
});
</script>
</body>
</html>
